"use strict";function phEscapeRegExp(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function phReplaceAll(e,t,n){return n.replace(new RegExp(phEscapeRegExp(e),"g"),t)}function startFullOverlay(){jQuery('<div id="phOverlay"><div id="phLoaderFull"> </div></div>').appendTo(document.body),jQuery("#phOverlay").fadeIn().css("display","block")}function stopOverlay(){jQuery("#phOverlay").fadeIn().css("display","none")}function phAiCreateQuestion(){var o=Joomla.getOptions("phParamsPC"),a=document.getElementById("jform_aidata_ai_keywords");["description","description_long","features","metadesc"].forEach(function(e){var t="ai_premade_question_"+e,n="";(n=(n=o[t]?o[t]:n)&&""!==a.value.trim()?n+": "+a.value.trim():n)&&(n+="."),document.getElementById("ai_question_"+e).value=n})}function phAiGenerateAnswer(e){var t="ai_parameters_"+e,n="ai_question_"+e,o="ai_content_"+e,a="ai_message_"+e,i=Joomla.getOptions("phParamsPC"),r=Joomla.getOptions("phLangPC"),s=i.aiApiKey,e=i.aiModel,i=i[t],t=document.getElementById(n).value,n={max_tokens:100,temperature:.5};void 0!==i&&""!=i&&(n=JSON.parse(i));e={prompt:t,model:e};if(Object.assign(e,e,n),""==s)return document.getElementById(a).innerHTML='<div class="ph-msg-error-box">'+r.COM_PHOCACART_ERROR_YOU_DID_NOT_PROVIDE_API_KEY+"</div>",!1;startFullOverlay(),fetch("https://api.openai.com/v1/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){void 0!==e.error&&(void 0!==e.error.message&&""!=e.error.message?document.getElementById(a).innerHTML='<div class="ph-msg-error-box">'+e.error.message+"</div>":console.log(e.error)),void 0!==e.choices[0].text&&""!=e.choices[0].text&&(e=(e=e.choices[0].text).trim(),document.getElementById(o).value=e),stopOverlay()}).catch(function(e){console.log(e),stopOverlay()})}function phAiPasteAnswer(e){var t=Joomla.getOptions("phLangPC"),n="ai_message_"+e,o="jform_"+e,a=phReplaceAll("\n","<br>",a=document.getElementById("ai_content_"+e).value),i=0,e="";(""==(e=1==(i=void 0!==Joomla.editors.instances[o]?1:i)?Joomla.editors.instances[o].getValue():document.getElementById(o).value)&&"<p></p>"!=e||1==confirm(t.COM_PHOCACART_DESTINATION_FIELD_NOT_EMPTY_PRESS_OK_TO_OVERWRITE_CONTENTS_IN_DESTINATION_FIELD))&&(1==i?Joomla.editors.instances[o].setValue(a):document.getElementById(o).value=a,document.getElementById(n).innerHTML='<div class="ph-msg-success-box">'+t.COM_PHOCACART_SUCCESS_CONTENT_INSERTED+"</div>")}document.addEventListener("DOMContentLoaded",function(){phAiCreateQuestion(),document.getElementById("jform_aidata_ai_keywords").addEventListener("keyup",phAiCreateQuestion,!1);var e=document.getElementById("phAiQuestionBox");e.querySelectorAll(".phBtnGenerate").forEach(function(e){e.addEventListener("click",function(e){phAiGenerateAnswer(e.target.dataset.typeid)})}),e.querySelectorAll(".phBtnPaste").forEach(function(e){e.addEventListener("click",function(e){phAiPasteAnswer(e.target.dataset.typeid)})})},!1);