function phEscapeRegExp(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function phReplaceAll(e,t,n){return n.replace(new RegExp(phEscapeRegExp(e),"g"),t)}function startFullOverlay(){jQuery('<div id="phOverlay"><div id="phLoaderFull"> </div></div>').appendTo(document.body),jQuery("#phOverlay").fadeIn().css("display","block")}function stopOverlay(){jQuery("#phOverlay").fadeIn().css("display","none")}function phAiCreateQuestion(){const a=Joomla.getOptions("phParamsPC");let o=document.getElementById("jform_aidata_ai_keywords");["description","description_long","features","metadesc"].forEach(e=>{var t="ai_premade_question_"+e;let n="";(n=(n=a[t]?a[t]:n)&&""!==o.value.trim()?n+": "+o.value.trim():n)&&(n+="."),document.getElementById("ai_question_"+e).value=n})}function phAiGenerateAnswer(e){var t="ai_parameters_"+e,n="ai_question_"+e;const a="ai_content_"+e,o="ai_message_"+e;var e=Joomla.getOptions("phParamsPC"),r=Joomla.getOptions("phLangPC"),i=e.aiApiKey,s=e.aiModel,e=e[t],t=document.getElementById(n).value;let d={max_tokens:100,temperature:.5};void 0!==e&&""!=e&&(d=JSON.parse(e));n={prompt:t,model:s};if(Object.assign(n,n,d),""==i)return document.getElementById(o).innerHTML='<div class="ph-msg-error-box">'+r.COM_PHOCACART_ERROR_YOU_DID_NOT_PROVIDE_API_KEY+"</div>",!1;startFullOverlay(),fetch("https://api.openai.com/v1/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify(n)}).then(e=>e.json()).then(t=>{if(void 0!==t.error&&(void 0!==t.error.message&&""!=t.error.message?document.getElementById(o).innerHTML='<div class="ph-msg-error-box">'+t.error.message+"</div>":console.log(t.error)),void 0!==t.choices[0].text&&""!=t.choices[0].text){let e=t.choices[0].text;e=e.trim(),document.getElementById(a).value=e}stopOverlay()}).catch(e=>{console.log(e),stopOverlay()})}function phAiPasteAnswer(e){var t=Joomla.getOptions("phLangPC"),n="ai_message_"+e,a="jform_"+e,e=phReplaceAll("\n","<br>",document.getElementById("ai_content_"+e).value);let o=0,r=(void 0!==Joomla.editors.instances[a]&&(o=1),"");(""==(r=1==o?Joomla.editors.instances[a].getValue():document.getElementById(a).value)&&"<p></p>"!=r||1==confirm(t.COM_PHOCACART_DESTINATION_FIELD_NOT_EMPTY_PRESS_OK_TO_OVERWRITE_CONTENTS_IN_DESTINATION_FIELD))&&(1==o?Joomla.editors.instances[a].setValue(e):document.getElementById(a).value=e,document.getElementById(n).innerHTML='<div class="ph-msg-success-box">'+t.COM_PHOCACART_SUCCESS_CONTENT_INSERTED+"</div>")}document.addEventListener("DOMContentLoaded",function(){phAiCreateQuestion();document.getElementById("jform_aidata_ai_keywords").addEventListener("keyup",phAiCreateQuestion,!1);var e=document.getElementById("phAiQuestionBox");e.querySelectorAll(".phBtnGenerate").forEach(e=>{e.addEventListener("click",e=>{phAiGenerateAnswer(e.target.dataset.typeid)})}),e.querySelectorAll(".phBtnPaste").forEach(e=>{e.addEventListener("click",e=>{phAiPasteAnswer(e.target.dataset.typeid)})})},!1);