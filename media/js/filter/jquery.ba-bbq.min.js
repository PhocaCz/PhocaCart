/*
 * jQuery BBQ: Back Button & Query Library - v1.3pre - 8/26/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
!function(t){"$:nomunge";function n(t){return"string"==typeof t}function e(t){var n=x.call(arguments,1);return function(){return t.apply(this,n.concat(x.call(arguments)))}}function r(t){return t.replace(v,"$2")}function o(t){return t.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function a(e,r,o,a,i){var c,l,p,h,d;return a!==u?(p=o.match(e?v:/^([^#?]*)\??([^#]*)(#?.*)/),d=p[3]||"",2===i&&n(a)?l=a.replace(e?g:I,""):(h=s(p[2]),a=n(a)?s[e?q:S](a):a,l=2===i?a:1===i?t.extend({},a,h):t.extend({},h,a),l=f(l),e&&(l=l.replace(y,j))),c=p[1]+(e?$:l||!p[1]?"?":"")+l+d):c=r(o!==u?o:location.href),c}function i(t,e,r){return e===u||"boolean"==typeof e?(r=e,e=w[t?q:S]()):e=n(e)?e.replace(t?g:I,""):e,s(e,r)}function c(e,r,o,a){return n(o)||"object"==typeof o||(a=o,o=r,r=u),this.each(function(){var n=t(this),i=r||m()[(this.nodeName||"").toLowerCase()]||"",c=i&&n.attr(i)||"";n.attr(i,w[e](c,o,a))})}var u,f,l,s,p,h,d,m,g,v,y,b,$,x=Array.prototype.slice,j=decodeURIComponent,w=t.param,N=t.bbq=t.bbq||{},A=t.event.special,C="hashchange",S="querystring",q="fragment",E="elemUrlAttr",R="href",U="src",I=/^.*\?|#.*$/g,Q={};w[S]=e(a,0,o),w[q]=l=e(a,1,r),w.sorted=f=function(n,e){var r=[],o={};return t.each(w(n,e).split("&"),function(t,n){var e=n.replace(/(?:%5B|=).*$/,""),a=o[e];a||(a=o[e]=[],r.push(e)),a.push(n)}),t.map(r,function(t){return o[t]}).join("&")},l.noEscape=function(n){n=n||"";var e=t.map(n.split(""),encodeURIComponent);y=new RegExp(e.join("|"),"g")},l.noEscape(",/"),l.ajaxCrawlable=function(t){return t!==u&&(t?(g=/^.*(?:#!|#)/,v=/^([^#]*)(?:#!|#)?(.*)$/,$="#!"):(g=/^.*#/,v=/^([^#]*)#?(.*)$/,$="#"),b=!!t),b},l.ajaxCrawlable(0),t.deparam=s=function(n,e){var r={},o={"true":!0,"false":!1,"null":null};return t.each(n.replace(/\+/g," ").split("&"),function(n,a){var i,c=a.split("="),f=j(c[0]),l=r,s=0,p=f.split("]["),h=p.length-1;if(/\[/.test(p[0])&&/\]$/.test(p[h])?(p[h]=p[h].replace(/\]$/,""),p=p.shift().split("[").concat(p),h=p.length-1):h=0,2===c.length)if(i=j(c[1]),e&&(i=i&&!isNaN(i)?+i:"undefined"===i?u:o[i]!==u?o[i]:i),h)for(;h>=s;s++)f=""===p[s]?l.length:p[s],l=l[f]=h>s?l[f]||(p[s+1]&&isNaN(p[s+1])?{}:[]):i;else t.isArray(r[f])?r[f].push(i):r[f]=r[f]!==u?[r[f],i]:i;else f&&(r[f]=e?u:"")}),r},s[S]=e(i,0),s[q]=p=e(i,1),t[E]||(t[E]=function(n){return t.extend(Q,n)})({a:R,base:R,iframe:U,img:U,input:U,form:"action",link:R,script:U}),m=t[E],t.fn[S]=e(c,S),t.fn[q]=e(c,q),N.pushState=h=function(t,e){n(t)&&/^#/.test(t)&&e===u&&(e=2);var r=t!==u,o=l(location.href,r?t:{},r?e:2);location.href=o},N.getState=d=function(t,n){return t===u||"boolean"==typeof t?p(t):p(n)[t]},N.removeState=function(n){var e={};n!==u&&(e=d(),t.each(t.isArray(n)?n:arguments,function(t,n){delete e[n]})),h(e,2)},A[C]=t.extend(A[C],{add:function(n){function e(t){var n=t[q]=l();t.getState=function(t,e){return t===u||"boolean"==typeof t?s(n,t):s(n,e)[t]},r.apply(this,arguments)}var r;return t.isFunction(n)?(r=n,e):(r=n.handler,void(n.handler=e))}})}(jQuery,this),function(t,n,e){"$:nomunge";function r(t){return t=t||location.href,"#"+t.replace(/^[^#]*#?(.*)$/,"$1")}var o,a="hashchange",i=document,c=t.event.special,u=i.documentMode,f="on"+a in n&&(u===e||u>7);t.fn[a]=function(t){return t?this.bind(a,t):this.trigger(a)},t.fn[a].delay=50,c[a]=t.extend(c[a],{setup:function(){return f?!1:void t(o.start)},teardown:function(){return f?!1:void t(o.stop)}}),o=function(){function o(){var e=r(),i=h(l);e!==l?(p(l=e,i),t(n).trigger(a)):i!==l&&(location.href=location.href.replace(/#.*/,"")+i),c=setTimeout(o,t.fn[a].delay)}var c,u={},l=r(),s=function(t){return t},p=s,h=s;return u.start=function(){c||o()},u.stop=function(){c&&clearTimeout(c),c=e},t.browser.msie&&!f&&function(){var n,e;u.start=function(){n||(e=t.fn[a].src,e=e&&e+r(),n=t('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){e||p(r()),o()}).attr("src",e||"javascript:0").insertAfter("body")[0].contentWindow,i.onpropertychange=function(){try{"title"===event.propertyName&&(n.document.title=i.title)}catch(t){}})},u.stop=s,h=function(){return r(n.location.href)},p=function(e,r){var o=n.document,c=t.fn[a].domain;e!==r&&(o.title=i.title,o.open(),c&&o.write('<script>document.domain="'+c+'"</script>'),o.close(),n.location.hash=e)}}(),u}()}(jQuery,this);